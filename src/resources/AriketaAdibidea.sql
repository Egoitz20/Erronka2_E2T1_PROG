DROP TABLE IRAKASGAIAK;
DROP TABLE IKASLEAK;
DROP TABLE MATRIKULA;
DROP TABLE HERRIAK;

CREATE TABLE IRAKASGAIAK (
	KODEA INT PRIMARY KEY,
    IZENA VARCHAR(25) NOT NULL
);

CREATE TABLE IKASLEAK(
	NA VARCHAR(9) PRIMARY KEY,
    IZENA VARCHAR(25) NOT NULL
); 

CREATE TABLE MATRIKULA (
	NA VARCHAR(9) NOT NULL,
    KODEA INT NOT NULL, 
    DATAK DATETIME NOT NULL,
    PRIMARY KEY (NA, KODEA, DATAK), 
    CONSTRAINT FK_KODEA FOREIGN KEY (KODEA) REFERENCES IRAKASGAIAK (KODEA),
    CONSTRAINT FK_NA FOREIGN KEY (NA) REFERENCES IKASLEAK (NA)
);

CREATE TABLE HERRIAK (
	KODEA INT PRIMARY KEY,
    IZENA VARCHAR(25)
);

INSERT INTO IKASLEAK (NA, IZENA) VALUES ('11111111A', 'Egoitz');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('22222222A', 'Ane');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('33333333A', 'Imanol');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('44444444A', 'Zunbeltz');

INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (1, 'PROG');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (2, 'BAD');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (3, 'LEN');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (4, 'ENT');

INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('11111111A', 1, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('22222222A', 1, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('22222222A', 2, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('44444444A', 4, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('33333333A', 3, now());

INSERT INTO HERRIAK (KODEA, IZENA) VALUES (1, 'Barakaldo');
INSERT INTO HERRIAK (KODEA, IZENA) VALUES (2, 'Trapagaran');

SELECT NA, IZENA FROM IKASLEAK WHERE NA = '11111111A';
SELECT * FROM IRAKASGAIAK WHERE KODEA = 2 AND IZENA = 'BAD';
SELECT * FROM IRAKASGAIAK ORDER BY IZENA;
SELECT * FROM IKASLEAK, IRAKASGAIAK;

ALTER TABLE IKASLEAK ADD COLUMN HERRIKODEA INT, ADD CONSTRAINT FK_HERRIKODEA FOREIGN KEY (HERRIKODEA) REFERENCES HERRIAK (KODEA);

UPDATE IKASLEAK SET HERRIKODEA = 1 WHERE NA = '11111111A';
UPDATE IKASLEAK SET HERRIKODEA = 2 WHERE NA = '22222222A';
UPDATE IKASLEAK SET HERRIKODEA = 1 WHERE NA = '33333333A';
UPDATE IKASLEAK SET HERRIKODEA = 2 WHERE NA = '44444444A';

SELECT * FROM IKASLEAK, HERRIAK;
SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

INSERT INTO HERRIAK (KODEA, IZENA) VALUES (3, 'Santurtzi');

SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

INSERT INTO IKASLEAK (NA, IZENA) VALUES ('55555555A', 'Andoni');

SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK INNER JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK LEFT JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK RIGHT JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

SELECT IKASLEAK.IZENA, MATRIKULA.DATAK, IRAKASGAIAK.IZENA FROM IKASLEAK 
INNER JOIN MATRIKULA ON IKASLEAK.NA = MATRIKULA.NA
INNER JOIN IRAKASGAIAK ON MATRIKULA.KODEA = IRAKASGAIAK.KODEA
ORDER BY IKASLEAK.IZENA, IRAKASGAIAK.IZENA DESC;



